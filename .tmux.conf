# vi/w/: foldmethod=marker

set-option -g prefix C-b
bind-key C-b send-prefix

set -g default-terminal "screen-256color"

set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
# bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

set -g base-index 1

# {{{ Window Split keys and movement

# default horizontal and vertical split keys
# unbind '"'
# unbind %
bind-key | split-window -h
bind-key - split-window -v
bind-key + resize-pane -Z

bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r h select-pane -L
bind-key -r l select-pane -R

# }}}

set -g history-limit 5000

bind R source-file ~/.tmux.conf \; display-message "Config reloaded..."

# setw -g monitor-activity on
set-option -g visual-activity on

set-option -g display-time 1000
set-window-option -g pane-base-index 1

setw -g automatic-rename on

bind C-k send-keys 'C-l'\; clear-history

bind-key -T prefix C-j command-prompt -p "join pane from:"  "join-pane -s '%%'"
bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"
bind-key S set-window-option synchronize-panes\; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"
bind-key P command-prompt -p 'save history to filename:' -I '~/tmux.history' 'capture-pane -S -32768 ; save-buffer %1 ; delete-buffer'

# {{{ Mouse Config

set -g mouse on

# Toggle mouse on and off
bind-key -T prefix C-m set -g mouse\; display 'Mouse: #{?mouse,ON,OFF}'
# set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# Selection with mouse should copy to clipboard right away, in addition to the default action.
bind -Tcopy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel\; run "tmux save-buffer - | xclip -i -sel clipboard >/dev/null || true"

# Drag to re-order windows
bind-key -n MouseDrag1Status swap-window -t=

unbind-key MouseDown2Pane

bind-key -n MouseDown2Pane run " \
  tmux set-buffer -- \"$(xclip -o -sel clipboard -sel clipboard);\"; \
  tmux paste-buffer -p; \
"

# }}}
# {{{ Tmux Plugin Manager

# Install new plugins from GitHub or any other git repository
# prefix + I
# 
# Refreshes TMUX environment
# 
# Updates plugin(s)
# prefix + U
# 
# Remove/uninstall plugins not on the plugin list
# prefix + alt + u

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Extracto
# You can fuzzy find your text instead of selecting it by mouse:
# 
# press tmux prefix + tab to start extrakto
# fuzzy find the text/path/url/line
# use custom filters (ctrl + f)
# press tab to insert it to the current pane,
# enter to copy it to the clipboard,
# see other features in HELP (press ctrl-h in extrakto)
set -g @plugin 'laktak/extrakto'

# Themes
# This needs to load before tmux-prefix-highlight
set -g @plugin "arcticicestudio/nord-tmux"
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# set -g @plugin 'charlietag/tmux-themes'
# set -g @plugin 'jabirali/tmux-powertab'

###
# set -g @plugin 'wfxr/tmux-power'
# set -g @tmux_power_show_upload_speed true
# set -g @tmux_power_show_download_speed true
# # 'L' for left only, 'R' for right only and 'LR' for both
# set -g @tmux_power_prefix_highlight_pos 'LR'
# set -g @tmux_power_theme '#483D8B' # dark slate blue
###

# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# tmux colors solarized is overwridden by vim/airline
#set -g @plugin 'seebi/tmux-colors-solarized'
# believe tmuxline is overwridden by vim/airline as well
#set -g @plugin 'edkolev/tmuxline.vim'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# }}}
# {{{ Fixup colors for Nord theme to make them readable

set -g message-style bg=brightblack,fg=white
set -g message-command-style bg=brightblack,fg=white

# }}}
